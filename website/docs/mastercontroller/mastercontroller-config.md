---
sidebar_position: 3
---

# Mastercontroller Configuration

## Host List Setup

The Host List files define the inventory of target endpoints that DataReach will connect to. You must configure these files before starting the service.

**Step 1: Initialize Configuration Files**

Log in to the Mastercontroller server as the `datareach` user. Navigate to the data directory and initialize the host lists by copying the templates:

```bash
cd /opt/rsa/datareach/mastercontroller/data
cp common_windows_hosts.csv customer_windows_hosts.csv
cp common_unix_hosts.csv customer_unix_hosts.csv
cp common_unix_hosts.csv customer_solaris_hosts.csv
cp common_db_hosts.csv customer_dboracle_hosts.csv
cp common_db_hosts.csv customer_dbmysql_hosts.csv
```

**Step 2: Populate Host Information**

Edit each of the newly created CSV files (`customer_*.csv`) to include your specific target servers. Each file must contain the following columns:

*   **host_type**: The category of the host (e.g., `Unix`, `Oracle`).
*   **host_name**: A unique identifier for the host within DataReach.
*   **connection_string**: The connection details, such as IP address, protocol, and port.
*   **credential_alias**: The key used to look up the password for this host from the credential provider.
*   **alias_type**: Specifies if the alias refers to a `USERNAME` or a `PROFILE`.

## Host Plugin Set Up

You must configure the XML files that tell the Mastercontroller which host lists to load.

**Step 1: Edit the Configuration File**

As the `datareach` user, navigate to the JDBC hostlist provider directory and open `config.xml` for editing:

```bash
cd /opt/rsa/datareach/mastercontroller/plugins/hostlist-provider-jdbc
vi config.xml
```

**Step 2: Update References**

Locate the `<agents>` section and update the `<query>` tags to point to your new CSV filenames (e.g., replace default names with `customer_oracle_hosts`).

1.  **Oracle**: Update `<agents> -> <oracle> -> <query>` to `customer_oracle_hosts`.
2.  **Oracle 11**: Add a new section for Oracle 11 if required.
3.  **Unix**: Update `<agents> -> <unix> -> <query>` to `customer_unix_hosts`.
4.  **MySQL**: Update `<agents> -> <mysql> -> <query>` to `customer_mysql_hosts`.

## Generate DR Environment Path

The `DR_ENV_PATH` variable is critical for the application framework to locate its components generally.

**Step 1: Generate the Path Value**

Run the `drutils.sh` utility to calculate the correct environment path string:

```bash
cd /opt/rsa/datareach/mastercontroller/scripts/
./drutils.sh envpath generate
```
*Copy the output value from this command.*

**Step 2: Update Framework Config**

Edit the framework configuration file and paste the generated value:

```bash
vi /opt/rsa/datareach/mastercontroller/scripts/framework/config.sh
```

Find the `export DR_ENV_PATH` line and update it:
```bash
export DR_ENV_PATH="<PASTE_GENERATED_VALUE_HERE>"
```

## Primary Master Controller Configuration File - setenv.sh

This file specifies environment variables for the Master Controller's web server (Tomcat).
Path: `/opt/rsa/datareach/mastercontroller/tomcat/tomcat-datareach/bin/setenv.sh`

| Parameter Name | Description |
| :--- | :--- |
| **DATAREACH_CWD** | Sets the root of the Mastercontroller installation. Set by startup script. |
| **DR_AGENT_CONFIG_DIR** | Agent configuration root directory. Default: `/opt/rsa/datareach/mastercontroller/agent_configs`. |
| **DR_MASTER_CONTROLLER_KEYSTORE** | Path to the Java keystore for TLS1.2 web service. |
| **DR_MASTER_CONTROLLER_KEYSTORE_PASSWORD** | Password for the keystore. Can be encrypted using `drutils.sh`. |
| **DR_MASTER_CONTROLLER_KEY_ALIAS** | Alias of the Mastercontroller certificate in the keystore. |
| **DR_MASTER_CONTROLLER_TRUSTSTORE** | Trust store for mutual-SSL authentication with Agents. |
| **DR_MASTER_CONTROLLER_TRUSTSTORE_PASSWORD** | Password for the trust store. Can be encrypted. |
| **DR_ENV_PATH** | Encryption seed - must be unique for each environment. Generated by `drutils.sh`. |
| **DR_PLUGINS_DIR** | Plugins root directory. Default: `/opt/rsa/datareach/mastercontroller/plugins`. |
| **DR_LOG4J2_CONFIG_FILE** | Log4j2 config file path. Default: `.../scripts/log4j2.xml`. |
| **DR_LOGS_DIR** | Logs directory. Default: `/opt/rsa/datareach/mastercontroller/logs`. |

## Encrypt Passwords

DataReach requires sensitive passwords (like the Keystore password and Database password) to be encrypted before being stored in configuration files.

**Step 1: Encrypt the Strings**

Use the encryption utility to generate secure strings. Replace `init1234` and `<<datareach database password>>` with your actual passwords:

```bash
cd /opt/rsa/datareach/mastercontroller/scripts/
./drutils.sh encrypt string init1234
./drutils.sh encrypt string <<datareach database password>>
```

**Step 2: Update Configuration Files**

Copy the **encrypted output string** (not the plain text password) and update the following files:

*   **Mastercontroller Config**:
    Edit `/opt/rsa/datareach/mastercontroller/scripts/framework/config.sh`:
    ```bash
    DR_MASTER_CONTROLLER_KEYSTORE_PASSWORD = <Encrypted_Keystore_Password>
    ```

*   **Agent Configs**:
    For each agent, edit `/opt/rsa/datareach/<AgentName>/config/agent_controller.xml` and update the `<keystore_password>` tag.

## Generate DataReach Certificates

Secure communication between the Master Controller and Agents relies on mutual TLS authentication using Java Keystores (JKS).

**Step 1: Backup Default Certificates**

Before generating new certificates, archive the existing defaults:

```bash
cd /opt/rsa/datareach/mastercontroller/scripts/
mkdir -p /opt/rsa/datareach/backupcert
mv /opt/rsa/datareach/mastercontroller/certificates/mastercontroller.jks /opt/rsa/datareach/backupcert
```

**Step 2: Generate New Certificates**

Run the certificate generation commands for the Root CA, Master Controller, and all required Agents.
*Ensure to use the same keystore password encrypted in the previous step (default example: `init1234`).*

```bash
./drutils.sh certs generateRoot -p init1234

# Master Controller Identity
./drutils.sh certs generateAgent -n mastercontroller -p init1234 -ca-password init1234

# Remote Agent Identities
./drutils.sh certs generateAgent -n aix -p init1234 -ca-password init1234
./drutils.sh certs generateAgent -n unix -p init1234 -ca-password init1234
./drutils.sh certs generateAgent -n windows -p init1234 -ca-password init1234
# ... (repeat for all other agents as listed below)
./drutils.sh certs generateAgent -n oracle -p init1234 -ca-password init1234
./drutils.sh certs generateAgent -n mssql1 -p init1234 -ca-password init1234
# ...
```

**Step 3: Secure Certificate Permissions**

Ensure that only the `datareach` user can read these sensitive files:

```bash
chmod -R 744 /opt/rsa/datareach/mastercontroller/certificates
```

## Agent Configuration Preparation

You need to prepare configuration folders for any new agents you are deploying.

**Step 1: Create Directory Structure**

For example, to configure an `oracle11` agent:

```bash
cd /opt/rsa/datareach/mastercontroller/agent_configs
mkdir -p oracle11/package/config
```

**Step 2: Populate Configuration**

Copy the default Unix configuration templates as a starting point:

```bash
cp -R /opt/rsa/datareach/mastercontroller/agent_configs/unix/* /opt/rsa/datareach/mastercontroller/agent_configs/oracle11
```

## Service Management

**Starting the Service**

To start the DataReach Mastercontroller, execute the startup script as the `datareach` user:

```bash
cd /opt/rsa/datareach/mastercontroller/scripts
./datareach_startup.sh
```

**Stopping the Service**

To stop the service, use the shutdown script:

```bash
/opt/rsa/datareach/mastercontroller/scripts/datareach_shutdown.sh
```

## Backup Management

It is critical to maintain backups of your certificates and configurations.

**Create Backup Directory**

SSH to the server as `root` and create a dedicated backup location:

```bash
mkdir -p /opt/rsa/backup
```
*Regularly copy your `/opt/rsa/datareach/` configuration files and certificates to this location.*
